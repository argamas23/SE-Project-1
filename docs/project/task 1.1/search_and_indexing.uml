@startuml

package "search" {
    
    interface IndexManager {
        + initialize()
        + search(...) : SearchResultList
        + addEntryIndexOperation(WeblogEntry)
        + addEntryReIndexOperation(WeblogEntry)
        + rebuildWeblogIndex(WeblogEntry)
        + removeWeblogIndex(WeblogEntry)
        + removeEntryIndexOperation(WeblogEntry)
    }

    class SearchResultList {
        - limit: int
        - offset: int
        - categories: Set<String>
        - results: List<WeblogEntryWrapper>
        + getLimit() : int
        + getOffset() : int
        + getResults() : List<WeblogEntryWrapper>
        + getCategories() : Set<String>
    }

    class SearchResultMap {
        - limit: int
        - offset: int
        - categories: Set<String>
        - results: Map<Date, Set<WeblogEntryWrapper>>
        + getLimit() : int
        + getOffset() : int
        + getResults() : Map<Date, Set<WeblogEntryWrapper>>
        + getCategories() : Set<String>
    }

    package "lucene" {
        
        class LuceneIndexManager {
            - String indexDir
            - boolean searchEnabled
            - ReadWriteLock rwl
            + getIndexDirectory() : Directory
            + getReadWriteLock() : ReadWriteLock
            + executeIndexOperationNow(IndexOperation)
            + scheduleIndexOperation(IndexOperation)
        }
        
        LuceneIndexManager .up.|> IndexManager : implements

        abstract class IndexOperation implements Runnable {
            # LuceneIndexManager manager
            - IndexWriter writer
            + run()
            {abstract} # doRun()
            # getDocument(WeblogEntry) : Document
            # beginWriting() : IndexWriter
            # endWriting()
        }

        class IndexUtil {
            {static} + getTerm(field, input) : Term
        }

        class FieldConstants {
            {static} + ID : String
            {static} + CONTENT : String
            {static} + CATEGORY : String
        }

        abstract class ReadFromIndexOperation extends IndexOperation {
            + run()
        }

        abstract class WriteToIndexOperation extends IndexOperation {
            + run()
        }

        class SearchOperation extends ReadFromIndexOperation {
            - IndexSearcher searcher
            - TopFieldDocs searchresults
            + doRun()
            + getResults()
        }

        class RebuildWebsiteIndexOperation extends WriteToIndexOperation {
            - Weblog website
            + doRun()
        }

        class RemoveWebsiteIndexOperation extends WriteToIndexOperation {
            - Weblog website
            + doRun()
        }

        class RemoveEntryOperation extends WriteToIndexOperation {
            - WeblogEntry data
            + doRun()
        }

        class ReIndexEntryOperation extends WriteToIndexOperation {
            - WeblogEntry data
            + doRun()
        }
        
        class AddEntryOperation extends WriteToIndexOperation {
            + doRun()
        }
    }

    
    LuceneIndexManager *-- IndexOperation : schedules >
    
    LuceneIndexManager ..> SearchResultList : creates >
    LuceneIndexManager ..> SearchResultMap : creates >
    
    IndexManager ..> SearchResultList : returns >
    
    SearchOperation ..> SearchResultList : supplies data for >
    IndexOperation - FieldConstants
    SearchOperation ..> IndexUtil : creates terms >  
}
@enduml